<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文章详情 - HZY</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 复用基础样式 */
        .article-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .article-header {
            margin-bottom: 2rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
        }
        
        .article-title {
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        
        .article-meta {
            color: #666;
            font-size: 0.9rem;
        }
        
        .article-content {
            line-height: 1.8;
        }
        
        .back-link {
            display: inline-block;
            margin-bottom: 1rem;
            color: #4a6cf7;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <!-- 侧边栏导航 -->
    <nav class="sidebar">
        <ul class="sidebar-nav">
            <li class="nav-item" onclick="window.location='https://hzy1618yzh.qzz.io/'">
                <i class="nav-icon fas fa-home"></i>
                <span class="nav-text">首页</span>
            </li>
            <li class="nav-item" onclick="window.location='https://hzy1618yzh.qzz.io/game'">
                <i class="nav-icon fas fa-gamepad"></i>
                <span class="nav-text">游戏</span>
            </li>
            <li class="nav-item" onclick="window.location='https://hzy1618yzh.qzz.io/tools'">
                <i class="nav-icon fas fa-wrench"></i>
                <span class="nav-text">工具</span>
            </li>
            <li class="nav-item" onclick="window.location='https://hzy1618yzh.qzz.io/article'">
                <i class="nav-icon fas fa-file-alt"></i>
                <span class="nav-text">文章</span>
            </li>
        </ul>
    </nav>

    <main class="article-container">
        <a href="https://hzy1618yzh.qzz.io/article" class="back-link">
            <i class="fas fa-arrow-left"></i> 返回文章列表
        </a>
        
        <div class="article-header">
            <h1 class="article-title" id="article-title">加载中...</h1>
            <div class="article-meta" id="article-meta"></div>
        </div>
        
        <div class="article-content" id="article-content">
            <div style="text-align:center;padding:3rem;">
                <i class="fas fa-spinner fa-spin"></i> 加载文章内容...
            </div>
        </div>
    </main>

    <script>
        // 1. 获取当前文章编码（从URL中提取）
        function getArticleCode() {
            // 从URL路径中提取编码（例如从 "/article/qg8pstsy" 中提取 "qg8pstsy"）
            const path = window.location.pathname;
            const parts = path.split('/').filter(part => part); // 过滤空字符串
            return parts.length >= 2 ? parts[1] : null; // 取路径中的第二个部分
        }

        // 2. 加载文章数据并渲染
        async function loadArticle() {
            const code = getArticleCode();
            
            // 验证编码是否存在
            if (!code) {
                showError('无效的文章地址');
                return;
            }

            try {
                // 3. 调用API获取文章数据（关键修复：确保API路径正确）
                const response = await fetch(`https://hzy1618yzh.qzz.io/api/articles/${code}`);
                
                // 4. 处理API错误（如404或500）
                if (!response.ok) {
                    if (response.status === 404) {
                        showError('文章不存在或已被删除');
                    } else {
                        showError(`服务器错误 (${response.status})`);
                    }
                    return;
                }
                
                // 5. 解析文章数据并渲染
                const article = await response.json();
                
                // 更新标题和元数据
                document.getElementById('article-title').textContent = article.title;
                document.getElementById('page-title').textContent = `${article.title} - HZY`;
                document.getElementById('article-meta').innerHTML = `
                    <span><i class="far fa-calendar"></i> ${new Date(article.createdAt).toLocaleString()}</span>
                    <span style="margin-left: 1rem;"><i class="far fa-hashtag"></i> ${article.code}</span>
                `;
                
                // 渲染Markdown内容
                const md = window.markdownit({
                    html: true,
                    breaks: true,
                    linkify: true
                });
                document.getElementById('article-content').innerHTML = md.render(article.content);
                
            } catch (error) {
                // 6. 处理网络错误（如API不可用）
                console.error('加载文章失败:', error);
                showError('无法连接到服务器，请稍后重试');
            }
        }

        // 显示错误信息
        function showError(message) {
            document.getElementById('article-title').textContent = '加载失败';
            document.getElementById('article-meta').innerHTML = '';
            document.getElementById('article-content').innerHTML = `
                <div class="error-state">
                    <i class="fas fa-exclamation-circle"></i>
                    <h3>${message}</h3>
                    <p style="margin-top: 1rem;">
                        <a href="https://hzy1618yzh.qzz.io/article" style="color: #4a6cf7;">
                            返回文章列表
                        </a>
                    </p>
                </div>
            `;
        }

        // 页面加载时执行
        document.addEventListener('DOMContentLoaded', loadArticle);
    </script>
</body>
</html>
